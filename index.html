<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pinterest Board Sorter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 {
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
      margin-bottom: 0.5rem;
    }
    button {
      display: block;
      margin: 0 auto 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
    #status {
      text-align: center;
      margin-bottom: 1rem;
      font-weight: bold;
    }
    #comparison {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-bottom: 2rem;
    }
    #comparison img {
      max-width: 45%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: border-color 0.2s;
    }
    #comparison img:hover {
      border-color: #007bff;
    }
    #sortedList {
      text-align: center;
    }
    #sortedList img {
      max-width: 100px;
      margin: 0.25rem;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <h1>Pinterest Board Sorter</h1>
  <p>Paste your pins’ image URLs here as a JSON array, e.g.:<br>
  <code>["https://i.pinimg.com/1.jpg","https://i.pinimg.com/2.jpg",…]</code></p>
  <textarea id="pinsInput">["https://i.pinimg.com/1.jpg","https://i.pinimg.com/2.jpg","https://i.pinimg.com/3.jpg"]</textarea>
  <button id="startSortBtn">Start Sorting</button>
  <div id="status"></div>
  <div id="comparison"></div>
  <div id="sortedList"></div>

  <script>
    // Entry point
    document.getElementById('startSortBtn').addEventListener('click', () => {
      let pins;
      try {
        pins = JSON.parse(document.getElementById('pinsInput').value);
        if (!Array.isArray(pins)) throw 'Not an array';
      } catch (e) {
        alert('Invalid JSON: ' + e);
        return;
      }
      startInteractiveSort(pins);
    });

    async function startInteractiveSort(pins) {
      document.getElementById('status').textContent = 'Sorting…';
      document.getElementById('sortedList').innerHTML = '';
      const sorted = await mergeSort(pins);
      document.getElementById('status').textContent = 'Sorting complete!';
      showFinalList(sorted);
    }

    // Recursive MergeSort, but comparisons use the user’s clicks
    async function mergeSort(arr) {
      if (arr.length <= 1) return arr;
      const mid = Math.floor(arr.length / 2);
      const left = await mergeSort(arr.slice(0, mid));
      const right = await mergeSort(arr.slice(mid));
      return await merge(left, right);
    }

    // Show two pins side-by-side, return whichever URL the user clicks
    function getUserChoice(leftUrl, rightUrl) {
      return new Promise(resolve => {
        const cmp = document.getElementById('comparison');
        cmp.innerHTML = '';

        const leftImg = document.createElement('img');
        leftImg.src = leftUrl;
        leftImg.alt = 'Left pin';
        leftImg.addEventListener('click', () => resolve(leftUrl));

        const rightImg = document.createElement('img');
        rightImg.src = rightUrl;
        rightImg.alt = 'Right pin';
        rightImg.addEventListener('click', () => resolve(rightUrl));

        cmp.appendChild(leftImg);
        cmp.appendChild(rightImg);
      });
    }

    // Merge two sorted arrays by repeatedly asking the user to choose
    async function merge(left, right) {
      const result = [];
      while (left.length && right.length) {
        const pick = await getUserChoice(left[0], right[0]);
        if (pick === left[0]) {
          result.push(left.shift());
        } else {
          result.push(right.shift());
        }
      }
      // one side is empty: concatenate the rest
      return result.concat(left).concat(right);
    }

    // Display the fully-sorted pins
    function showFinalList(sorted) {
      const container = document.getElementById('sortedList');
      container.innerHTML = '<h2>Your Ranked Pins</h2>';
      sorted.forEach(url => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = 'Pin';
        container.appendChild(img);
      });
    }
  </script>
</body>
</html>
